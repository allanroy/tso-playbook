---

- name: Check if remote {{ server.name  }} host port {{ server.port }}
  wait_for: host={{ server.name  }} port={{ server.port }} timeout=1
  ignore_errors: True
  register: result-{{ server.name  }}
  with_items: "{{ server }}"
  when: ansible_hostname != {{ server.name  }}
  
- debug: 
    msg: result-{{ server.name  }}"
  
#- name: Save result in CSV
#  shell: printf "\n,{{ remote1 }} port is {% if result.failed %}closed{% else %}open{% endif %}"  >> /tmp/x_output.csv
#  args:
#    executable: /bin/bash
